<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="WARN" monitorInterval="30">
    <!-- 공통 변수 -->
    <Properties>
        <!-- 날짜 포맷  : yyyy-MM-dd HH:mm:ss.SSS -->
        <Property name="LOG_DATEFORMAT_PATTERN">yyyy-MM-dd HH:mm:ss.SSS</Property>

        <!-- 로그 레벨  : 5칸 고정 오른쪽 정렬 -->
        <Property name="LOG_LEVEL_PATTERN">%5p</Property>

        <!-- 스레드명   : 괄호에 감싸진 15자  -->
        <Property name="LOG_THREAD_PATTERN">[%15.15t]</Property>

        <!-- 로거명    : 40자 왼쪽 정렬 -->
        <Property name="LOG_LOGGER_PATTERN">%-40.40logger{39}</Property>

        <!-- 구분자 -->
        <Property name="LOG_SEP_MAIN"> --- </Property>
        <Property name="LOG_SEP_COLON"> : </Property>

        <!-- 예외 출력 -->
        <Property name="LOG_EXCEPTION_WORD">%throwable</Property>

        <!-- 콘솔 로그 패턴 -->
        <Property name="CONSOLE_LOG_PATTERN">
            %style{%d{${LOG_DATEFORMAT_PATTERN}}}{dim} %highlight{${LOG_LEVEL_PATTERN}}{FATAL=bg_red, ERROR=red, WARN=yellow, INFO=green, DEBUG=blue, TRACE=cyan} %style{${LOG_SEP_MAIN}}{dim} %style{${LOG_THREAD_PATTERN}}{dim} %style{${LOG_LOGGER_PATTERN}}{cyan} %style{${LOG_SEP_COLON}}{dim} %m%n${LOG_EXCEPTION_WORD}
        </Property>

        <!-- 파일 로그 패턴 -->
        <Property name="FILE_LOG_PATTERN">
            %d{${LOG_DATEFORMAT_PATTERN}} ${LOG_LEVEL_PATTERN} ${LOG_SEP_MAIN} ${LOG_THREAD_PATTERN} ${LOG_LOGGER_PATTERN} ${LOG_SEP_COLON} %m%n${LOG_EXCEPTION_WORD}
        </Property>

        <!-- 공통 로그 디렉터리 -->
        <Property name="LOG_DIR">logs</Property>
        <!-- 프로덕션 환경 로그 -->
        <Property name="PROD_FILE_NAME">prod</Property>
        <!-- 개발 환경 로그 -->
        <Property name="DEV_FILE_NAME">dev</Property>
        <!-- 로컬 환경 로그 -->
        <Property name="LOCAL_FILE_NAME">local</Property>
    </Properties>

    <!-- 로깅 쓰기자 -->
    <Appenders>
        <!-- 콘솔       : 하이라이팅하여 콘솔에 표시 -->
        <Console name="Console" target="SYSTEM_OUT">
            <PatternLayout
                    pattern="${CONSOLE_LOG_PATTERN}"
                    disableAnsi="false"
                    noConsoleNoAnsi="false"/>
        </Console>

        <!-- 프로덕션 로그 : 1일/10MB 롤링, 보관 7개 -->
        <RollingFile name="ProdFile"
                     fileName="${LOG_DIR}/${PROD_FILE_NAME}.log"
                     filePattern="${LOG_DIR}/${PROD_FILE_NAME}-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${FILE_LOG_PATTERN}"/>
            <Policies>
                <TimeBasedTriggeringPolicy interval="1"/>
                <SizeBasedTriggeringPolicy size="10MB"/>
            </Policies>
            <DefaultRolloverStrategy max="7"/>
        </RollingFile>

        <!-- 개발 로그    : 1일/10MB 롤링, 보관 5개 -->
        <RollingFile name="DevFile"
                     fileName="${LOG_DIR}/${DEV_FILE_NAME}.log"
                     filePattern="${LOG_DIR}/${DEV_FILE_NAME}-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${FILE_LOG_PATTERN}"/>
            <Policies>
                <TimeBasedTriggeringPolicy interval="1"/>
                <SizeBasedTriggeringPolicy size="10MB"/>
            </Policies>
            <DefaultRolloverStrategy max="5"/>
        </RollingFile>

        <!-- 로컬 파일    : 1일/10MB 롤링, 보관 5개 -->
        <RollingFile name="LocalFile"
                     fileName="${LOG_DIR}/${LOCAL_FILE_NAME}.log"
                     filePattern="${LOG_DIR}/${LOCAL_FILE_NAME}-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${FILE_LOG_PATTERN}"/>
            <Policies>
                <TimeBasedTriggeringPolicy interval="1"/>
                <SizeBasedTriggeringPolicy size="10MB"/>
            </Policies>
            <DefaultRolloverStrategy max="5"/>
        </RollingFile>
    </Appenders>

    <!-- 로깅 이벤트 수신자 -->
    <Loggers>
        <!-- 프로덕션 환경 -->
        <SpringProfile name="prod">
            <Root level="info">
                <AppenderRef ref="ProdFile"/>
                <AppenderRef ref="Console"/>
            </Root>
            <Logger name="org.springframework" level="warn"/>
        </SpringProfile>

        <!-- 개발 환경 -->
        <SpringProfile name="dev">
            <Root level="info">
                <AppenderRef ref="DevFile"/>
                <AppenderRef ref="Console"/>
            </Root>
            <Logger name="org.springframework" level="warn"/>
            <Logger name="queuing.core" level="debug"/>
        </SpringProfile>

        <!-- 로컬 환경 -->
        <SpringProfile name="local">
            <Root level="info">
                <AppenderRef ref="LocalFile"/>
                <AppenderRef ref="Console"/>
            </Root>
            <Logger name="org.springframework" level="warn"/>
            <Logger name="queuing.core" level="debug"/>
        </SpringProfile>
    </Loggers>
</Configuration>
